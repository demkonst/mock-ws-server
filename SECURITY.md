# Безопасность токенов авторизации

## Обзор

В проекте используются JWT токены для авторизации операторов. Эти токены содержат конфиденциальную информацию и должны быть защищены.

## Текущие меры безопасности

### 1. Скрытие токенов в конфигурации

Токены авторизации скрыты в файлах конфигурации:
- `.env.dev`
- `.env.demo` 
- `.env.stage`

Токены закомментированы с пометкой `***HIDDEN***` для предотвращения случайного раскрытия.

### 2. Структура токенов

JWT токены содержат:
- **Header**: алгоритм подписи (HS256)
- **Payload**: 
  - `sub` - ID оператора
  - `exp` - время истечения
  - `iat` - время создания
- **Signature**: подпись токена

### 3. Переменные окружения

```env
# Авторизация
AUTH_HEADER=Basic aW5rLW1vbjppbmttb25pdG9yaW5n

# Токены для операторов (скрыты для безопасности)
# AUTH_TOKEN_OPERATOR_01=***HIDDEN***
# AUTH_TOKEN_OPERATOR_02=***HIDDEN***
# ... и т.д.

# Реальные токены (раскомментировать при необходимости)
AUTH_TOKEN_OPERATOR_01=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Рекомендации по безопасности

### 1. Управление токенами

- ✅ Токены скрыты в конфигурации
- ✅ Созданы backup файлы с оригинальными токенами
- ✅ Токены имеют ограниченное время жизни
- ⚠️ Регулярно обновляйте токены
- ⚠️ Не коммитьте токены в git

### 2. Доступ к файлам

- ✅ Файлы `.env.*` имеют права доступа 600 (только владелец)
- ✅ Backup файлы созданы для восстановления
- ⚠️ Ограничьте доступ к файлам конфигурации

### 3. Мониторинг

- ✅ Логирование попыток авторизации
- ⚠️ Настройте алерты на подозрительную активность
- ⚠️ Регулярно проверяйте логи

## Восстановление токенов

Если нужно восстановить токены:

```bash
# Восстановить из backup
cp .env.dev.backup .env.dev

# Или раскомментировать в текущем файле
# AUTH_TOKEN_OPERATOR_01=***HIDDEN***
# ↓
AUTH_TOKEN_OPERATOR_01=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Обновление токенов

1. Получите новые токены от администратора
2. Обновите соответствующие переменные в `.env.*` файлах
3. Создайте новые backup файлы
4. Перезапустите сервер

## Аварийные процедуры

### При компрометации токена:

1. Немедленно отзовите токен
2. Получите новый токен
3. Обновите конфигурацию
4. Проверьте логи на подозрительную активность
5. Уведомите команду безопасности

### При потере доступа:

1. Используйте backup файлы для восстановления
2. Обратитесь к администратору для получения новых токенов
3. Обновите конфигурацию
4. Проверьте целостность системы

## Контакты

При проблемах с безопасностью обращайтесь к:
- Администратору системы
- Команде безопасности
- DevOps команде 